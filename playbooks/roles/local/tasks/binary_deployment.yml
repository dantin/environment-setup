---

- name: Download third-party code
  get_url:
    url: "{{ item.url }}"
    dest: "{{ downloads_dir }}/{{ item.name }}-{{ item.version }}.tar.gz"
    checksum: "{{ item.checksum | default(omit) }}"
    validate_certs: no
  register: get_url_result
  until: "'OK' in get_url_result.msg or 'file already exists' in get_url_result.msg"
  retries: "{{ retry_count }}"
  delay: "{{ retry_stagger | random + 3 }}"
  with_items: "{{ third_party_code }}"
  when:
    - has_outbound_network

- name: Download third-party binary
  get_url:
    url: "{{ item.url }}"
    dest: "{{ downloads_dir }}/{{ item.name }}-{{ item.version }}.tar.gz"
    checksum: "{{ item.checksum | default(omit) }}"
    validate_certs: no
  register: get_url_result
  until: "'OK' in get_url_result.msg or 'file already exists' in get_url_result.msg"
  retries: "{{ retry_count }}"
  delay: "{{ retry_stagger | random + 3 }}"
  with_items: "{{ third_party_binary }}"
  when:
    - has_outbound_network
